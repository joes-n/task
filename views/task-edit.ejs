<%- include('partials/header') %>

<div class="dashboard">
    <div class="dashboard-header">
        <h2>Edit Task</h2>
        <div class="user-info">
            <a href="/tasks" class="btn btn-secondary">
                <span class="btn-label--baseline-fix">‚Üê Back to Tasks</span>
            </a>
        </div>
    </div>

    <div style="max-width: 600px; margin: 0 auto;">
        <% if (typeof error !== 'undefined') { %>
            <div class="alert alert-error">
                <%= error %>
            </div>
        <% } %>

        <form action="/tasks/<%= task._id %>?_method=PUT" method="POST" class="task-edit-form">
            <div class="form-group">
                <label for="title">Title *</label>
                <input
                    type="text"
                    id="title"
                    name="title"
                    value="<%= task.title %>"
                    required
                    maxlength="200"
                    autofocus
                >
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea
                    id="description"
                    name="description"
                    rows="4"
                    maxlength="1000"
                ><%= task.description %></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status" name="status">
                        <option value="pending" <%= task.status === 'pending' ? 'selected' : '' %>>Pending</option>
                        <option value="in-progress" <%= task.status === 'in-progress' ? 'selected' : '' %>>In Progress</option>
                        <option value="completed" <%= task.status === 'completed' ? 'selected' : '' %>>Completed</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="priority">Priority</label>
                    <select id="priority" name="priority">
                        <option value="low" <%= task.priority === 'low' ? 'selected' : '' %>>Low</option>
                        <option value="medium" <%= task.priority === 'medium' ? 'selected' : '' %>>Medium</option>
                        <option value="high" <%= task.priority === 'high' ? 'selected' : '' %>>High</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="dueDate">Due (include date and time)</label>
                <input
                    type="datetime-local"
                    id="dueDate"
                    name="dueDate"
                    value="<%= task.dueDate ? (() => {
                        const d = new Date(task.dueDate);
                        const year = d.getFullYear();
                        const month = String(d.getMonth() + 1).padStart(2, '0');
                        const day = String(d.getDate()).padStart(2, '0');
                        const hours = String(d.getHours()).padStart(2, '0');
                        const minutes = String(d.getMinutes()).padStart(2, '0');
                        return `${year}-${month}-${day}T${hours}:${minutes}`;
                    })() : '' %>"
                >
            </div>

            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">
                    <span class="btn-label--baseline-fix">Update Task</span>
                </button>
                <a href="/tasks" class="btn btn-secondary">
                    <span class="btn-label--baseline-fix">Cancel</span>
                </a>
            </div>
        </form>
    </div>
</div>

<%- include('partials/footer') %>
