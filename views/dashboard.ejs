<%- include('partials/header') %>

<div class="dashboard">
    <div class="dashboard-header">
        <h2>My Tasks</h2>
        <div class="user-info">
            <a href="/tasks/new" class="btn btn-primary">+ Create New Task</a>
            <form action="/logout" method="POST" class="logout-form">
                <button type="submit" class="btn btn-secondary">Logout</button>
            </form>
        </div>
    </div>

    <div class="task-controls">
        <form action="/tasks" method="GET" class="search-box">
            <input
                type="text"
                name="search"
                placeholder="Search tasks..."
                value="<%= filters.search || '' %>"
            >

            <select name="status">
                <option value="">All Statuses</option>
                <option value="pending" <%= filters.status === 'pending' ? 'selected' : '' %>>Pending</option>
                <option value="in-progress" <%= filters.status === 'in-progress' ? 'selected' : '' %>>In Progress</option>
                <option value="completed" <%= filters.status === 'completed' ? 'selected' : '' %>>Completed</option>
            </select>

            <select name="priority">
                <option value="">All Priorities</option>
                <option value="low" <%= filters.priority === 'low' ? 'selected' : '' %>>Low</option>
                <option value="medium" <%= filters.priority === 'medium' ? 'selected' : '' %>>Medium</option>
                <option value="high" <%= filters.priority === 'high' ? 'selected' : '' %>>High</option>
            </select>

            <select name="sort">
                <option value="newest">Newest First</option>
                <option value="oldest" <%= filters.sort === 'oldest' ? 'selected' : '' %>>Oldest First</option>
                <option value="dueDate" <%= filters.sort === 'dueDate' ? 'selected' : '' %>>By Due (include date and time)</option>
            </select>

            <button type="submit" class="btn btn-primary btn-small">Search</button>
            <a href="/tasks" class="btn btn-secondary btn-small">Clear</a>
        </form>
    </div>

    <% if (typeof tasks !== 'undefined' && tasks.length > 0) { %>
        <div class="tasks-grid">
            <% tasks.forEach(task => { %>
                <div class="task-card">
                    <h3><%= task.title %></h3>
                    <% if (task.description) { %>
                        <p><%= task.description %></p>
                    <% } %>

                    <div class="task-meta">
                        <span class="task-status status-<%= task.status %>">
                            <%= task.status %>
                        </span>
                        <span class="task-priority priority-<%= task.priority %>">
                            <%= task.priority %> priority
                        </span>
                        <% if (task.dueDate) { %>
                            <span>
                                Due: <%= new Date(task.dueDate).toLocaleString() %>
                            </span>
                        <% } %>
                    </div>

                    <div class="task-actions">
                        <a href="/tasks/<%= task._id %>" class="btn btn-secondary btn-small">View</a>
                        <a href="/tasks/<%= task._id %>/edit" class="btn btn-secondary btn-small">Edit</a>
                        <form action="/tasks/<%= task._id %>?_method=DELETE" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-small" onclick="return confirm('Are you sure you want to delete this task?')">Delete</button>
                        </form>
                    </div>
                </div>
            <% }) %>
        </div>
    <% } else { %>
        <div class="empty-state">
            <h3>No tasks found</h3>
            <p>Create your first task to get started!</p>
            <a href="/tasks/new" class="btn btn-primary">Create New Task</a>
        </div>
    <% } %>
</div>

<%- include('partials/footer') %>
